<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Votify TV</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0d0f1a;
  --card:#151829;
  --border:#23263a;
  --accent:#7c5cff;
  --text:#ffffff;
  --muted:#9aa0c3;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:linear-gradient(145deg,#0d0f1a,#121528);
  color:var(--text);
  height:100vh;
  display:flex;
}

.video-side{
  flex:2;
  background:black;
}

.sidebar{
  flex:1;
  background:var(--card);
  padding:30px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

h2{margin:0;font-size:22px}

.qr-card{
  background:#0f1220;
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
}

.qr-box{
  background:#fff;
  border-radius:16px;
  padding:16px;
  display:flex;
  justify-content:center;
  align-items:center;
}

#voteLink{
  margin-top:10px;
  font-size:13px;
  color:var(--muted);
  word-break:break-all;
}

.small{
  font-size:12px;
  color:var(--muted);
  opacity:.9;
}
</style>
</head>

<body>

<div class="video-side"></div>

<div class="sidebar">
  <h2>üì± Escanea para votar</h2>

  <div class="qr-card">
    <div class="qr-box">
      <canvas id="qr" width="220" height="220"></canvas>
    </div>
    <div id="voteLink"></div>
    <div class="small" id="roomInfo"></div>
  </div>

  <div class="small">
    Si escaneas y dice ‚ÄúRestaurante no existe‚Äù, crea una sala NUEVA en <b>/admin</b> (en Render Free las salas se borran si el servidor reinicia).
  </div>
</div>

<!-- ‚úÖ Librer√≠a local (NO CDN) -->
<script src="/vendor/qrcode.min.js"></script>

<script>
(function(){
  // ‚úÖ roomId seguro aunque la URL termine en / al final
  const parts = window.location.pathname.split("/").filter(Boolean);
  const roomId = parts[parts.length - 1];

  const voteUrl = window.location.origin + "/r/" + roomId;

  document.getElementById("voteLink").textContent = voteUrl;
  document.getElementById("roomInfo").textContent = "Sala: " + roomId;

  try {
    if (!window.QRCode) throw new Error("QRCode library not loaded");
    QRCode.toCanvas(document.getElementById("qr"), voteUrl, {
      width: 220,
      margin: 2,
      errorCorrectionLevel: "M"
    });
  } catch (e) {
    console.error(e);
    document.getElementById("qr").replaceWith(
      Object.assign(document.createElement("div"), {
        innerText: "QR no disponible. Usa el link.",
        style: "background:#fff;color:#000;padding:12px;border-radius:12px"
      })
    );
  }
})();
</script>

</body>
</html>